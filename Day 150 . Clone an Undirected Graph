// User function Template for Java

/*
    class Node{
        int val;
        ArrayList<Node> neighbors;
        public Node(){
            val = 0;
            neighbors = new ArrayList<>();
        }

        public Node(int val){
            this.val = val;
            neighbors = new ArrayList<>();
        }

        public Node(int val, ArrayList<Node> neighbors){
            this.val = val;
            this.neighbors = neighbors;
        }
    }
*/
class Solution {
    private HashMap<Node, Node> map = new HashMap<>();
    
    Node cloneGraph(Node node) {
        if (node == null) return null;
        return dfs(node);
    }
    
    private Node dfs(Node node) {
        if (map.containsKey(node)) {
            return map.get(node);
        }
        
        // Create a new copy of the node
        Node clone = new Node(node.val, new ArrayList<>());
        map.put(node, clone);
        
        // Clone all neighbors recursively
        for (Node neigh : node.neighbors) {
            clone.neighbors.add(dfs(neigh));
        }
        
        return clone;
    }
}
